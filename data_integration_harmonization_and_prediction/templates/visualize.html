<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Data Visualization</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="container">
        <h1 class="mt-5">Data Visualization</h1>
        
        <h3>First Five Rows of the Dataset:</h3>
        <div class="table-responsive">
            {{ first_five_rows|safe }}
        </div>

        <h3>Univariate Plots:</h3>
        <div class="row">
            {% for plot in univariate_plots.values() %}
                <div class="col-md-6">
                    {{ plot|safe }}
                </div>
            {% endfor %}
        </div>

        <h3>Bivariate Plots:</h3>
        <div class="row">
            {% for plot in bivariate_plots.values() %}
                <div class="col-md-6">
                    {{ plot|safe }}
                </div>
            {% endfor %}
        </div>

        <h3>Correlation Matrix:</h3>
        <div>
            {{ correlation_matrix_plot|safe }}
        </div>

        <h3>Select Target Column for Analysis:</h3>
        <form id="target-selection-form">
            <input type="hidden" name="data" value="{{ data }}">
            <select name="target_column" class="form-control" id="target-column">
                {% for column in columns %}
                    <option value="{{ column }}">{{ column }}</option>
                {% endfor %}
            </select>
            <button type="button" class="btn btn-primary mt-3" id="analyze-button">Analyze</button>
        </form>
    </div>

    <script>
        $(document).ready(function() {
            $('#analyze-button').click(function() {
                const targetColumn = $('#target-column').val();
                const data = $('input[name="data"]').val();
                
                $.ajax({
                    url: '/analyze',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ target_column: targetColumn, data: JSON.parse(data), is_classification: false }), // Adjust is_classification as needed
                    success: function(response) {
                        // Handle the successful response, e.g., display results
                        $('body').html(response); // This will replace the current page with the response
                    },
                    error: function(xhr) {
                        alert('Error: ' + xhr.responseText);
                    }
                });
            });
        });
    </script>
</body>
</html>
